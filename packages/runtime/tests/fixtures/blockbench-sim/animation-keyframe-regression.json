{
  "name": "animation-keyframe-regression",
  "project": {
    "format": "geckolib",
    "name": "Animation Keyframe Regression",
    "textureResolution": { "width": 64, "height": 64 }
  },
  "steps": [
    {
      "op": "add_bone",
      "payload": { "name": "body" },
      "expect": [{ "path": "ok", "equals": true }]
    },
    {
      "op": "create_animation_clip",
      "payload": { "name": "idle", "length": 2, "loop": true, "fps": 20 },
      "expect": [{ "path": "ok", "equals": true }]
    },
    {
      "op": "set_frame_pose",
      "payload": {
        "clip": "idle",
        "frame": 20,
        "bones": [{ "name": "body", "rot": [-2, 0, 0] }]
      },
      "expect": [
        { "path": "ok", "equals": true },
        { "path": "data.time", "equals": 1 },
        { "path": "data.channels", "equals": 1 }
      ]
    },
    {
      "op": "delete_animation_clip",
      "payload": { "name": "idle" },
      "expect": [{ "path": "ok", "equals": true }]
    },
    {
      "op": "create_animation_clip",
      "payload": { "name": "idle", "length": 2, "loop": true, "fps": 20 },
      "expect": [{ "path": "ok", "equals": true }]
    },
    {
      "op": "set_frame_pose",
      "payload": {
        "clip": "idle",
        "frame": 0,
        "bones": [{ "name": "body", "rot": [2, 0, 0] }]
      },
      "expect": [
        { "path": "ok", "equals": true },
        { "path": "data.time", "equals": 0 },
        { "path": "data.channels", "equals": 1 }
      ]
    },
    {
      "op": "get_project_state",
      "payload": { "detail": "full" },
      "expect": [
        { "path": "ok", "equals": true },
        { "path": "data.project.animations[0].channels[0].channel", "equals": "rot" },
        { "path": "data.project.animations[0].channels[0].keys[0].value[0]", "equals": 2 }
      ]
    }
  ]
}

