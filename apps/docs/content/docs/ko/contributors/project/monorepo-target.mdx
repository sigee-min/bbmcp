---
title: "Ashfox 이중 트랙 런타임 레이아웃"
description: "플러그인 배포와 서버 배포를 기준으로 한 현재 이중 트랙 토폴로지입니다."
summary: "플러그인 배포와 서버 배포를 기준으로 한 현재 이중 트랙 토폴로지입니다."
---

# Ashfox 이중 트랙 런타임 레이아웃

이 문서는 현재 이중 트랙 아키텍처 스캐폴드를 설명합니다.

- 트랙 A: Blockbench 플러그인 런타임 (`apps/plugin-desktop` + `apps/ashfox`)
- 트랙 B: 서버 배포 (`apps/web` + `apps/gateway` + `apps/worker`)
  - 트랙 B의 gateway는 네이티브 엔진 MCP만 제공합니다.

## 실행 경계(Executable Boundaries)

- 플러그인 번들 엔트리: `apps/plugin-desktop/src/index.ts`
- 헤드리스/사이드카 엔트리: `apps/ashfox/src/index.ts`
- MCP 게이트웨이 엔트리: `apps/gateway/src/index.ts`
- 워커 엔트리: `apps/worker/src/index.ts`
- 대시보드/API 셸: `apps/web/src/app/*`
- 런타임 구현: `packages/runtime/src/*`
- 계약 소스 오브 트루스: `packages/contracts/src/mcpSchemas/*`, `packages/contracts/src/types/*`
- 컨포먼스 점검: `packages/conformance/tests/*`
- 백엔드 추상화 레이어: `packages/backend-core/src/*`
- 백엔드 어댑터:
  - `packages/backend-blockbench/src/*`
  - `packages/backend-engine/src/*`
- 사용자 문서 사이트: `apps/docs/*`

## 저장소 레이아웃

```text
apps/
  plugin-desktop/      # Blockbench plugin runtime shell
  ashfox/              # UI-less MCP runtime shell
  gateway/             # Native MCP gateway shell (engine only)
  worker/              # Async worker shell
  web/                 # React + Vite 대시보드 UI
  docs/                # User-facing documentation site
packages/
  runtime/             # Shared runtime implementation
  contracts/           # MCP schemas + contract types
  conformance/         # Protocol/tool conformance checks
  backend-core/        # Backend contract + registry + lock manager
  backend-blockbench/  # Blockbench plugin track adapter
  backend-engine/      # Clean-room engine adapter scaffold
deploy/
  docker-compose.yml   # 멀티 서비스 스캐폴드 (gateway/worker/db, UI는 gateway 서빙)
config/
  quality/             # Quality baselines (coverage, gates)
  specs/               # Blockbench spec snapshots
scripts/
  ...                  # Build/test/quality/release tooling
```

## 설계 규칙

1. MCP 계약은 `packages/contracts/src/*`에 런타임 독립적으로 유지합니다.
2. gateway MCP 라우팅은 네이티브(`engine`)로 고정하고, Blockbench 어댑터 경로는 플러그인 트랙으로 분리합니다.
3. Blockbench 전용 로직은 `packages/backend-blockbench` 뒤로 숨깁니다.
4. 클린룸 실행은 `packages/backend-engine`에서 점진적으로 확장합니다.
5. 게이트웨이 경로의 변경 요청은 프로젝트 단위 직렬화로 revision 안정성을 보장합니다.
6. `toolSchemaVersion`은 거친 버전 신호로 보고, 클라이언트 캐시 갱신의 기준은 `toolRegistry.hash`를 우선 사용합니다.
