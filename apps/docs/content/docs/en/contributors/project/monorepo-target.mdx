---
title: "Ashfox Two-Track Runtime Layout"
description: "Current two-track topology for plugin and server deployments."
summary: "Current two-track topology for plugin and server deployments."
---

# Ashfox Two-Track Runtime Layout

This document describes the current two-track architecture scaffold:
- Track A: Blockbench plugin runtime (`apps/plugin-desktop` + `apps/ashfox`)
- Track B: server deployment (`apps/web` + `apps/gateway` + `apps/worker`)
  - Gateway in Track B serves native engine MCP only.

## Executable Boundaries

- Plugin bundle entry: `apps/plugin-desktop/src/index.ts`
- Headless/sidecar entry: `apps/ashfox/src/index.ts`
- MCP gateway entry: `apps/gateway/src/index.ts`
- Worker entry: `apps/worker/src/index.ts`
- Dashboard/API shell: `apps/web/src/app/*`
- Runtime implementation: `packages/runtime/src/*`
- Contract source of truth: `packages/contracts/src/mcpSchemas/*` and `packages/contracts/src/types/*`
- Conformance checks: `packages/conformance/tests/*`
- Backend abstraction layer: `packages/backend-core/src/*`
- Backend adapters:
  - `packages/backend-blockbench/src/*`
  - `packages/backend-engine/src/*`
- User-facing docs site: `apps/docs/*`

## Repository Layout

```text
apps/
  plugin-desktop/      # Blockbench plugin runtime shell
  ashfox/              # UI-less MCP runtime shell
  gateway/             # Native MCP gateway shell (engine only)
  worker/              # Async worker shell
  web/                 # React + Vite dashboard UI
  docs/                # User-facing documentation site
packages/
  runtime/             # Shared runtime implementation
  contracts/           # MCP schemas + contract types
  conformance/         # Protocol/tool conformance checks
  backend-core/        # Backend contract + registry + lock manager
  backend-blockbench/  # Blockbench plugin track adapter
  backend-engine/      # Clean-room engine adapter scaffold
deploy/
  docker-compose.yml   # Multi-service scaffold (gateway/worker/db, UI served by gateway)
config/
  quality/             # Quality baselines (coverage, gates)
  specs/               # Blockbench spec snapshots
scripts/
  ...                  # Build/test/quality/release tooling
```

## Design Rules

1. Keep MCP contracts stable and runtime-agnostic in `packages/contracts/src/*`.
2. Keep gateway MCP routing native (`engine`) and keep Blockbench adapter paths in plugin track only.
3. Keep Blockbench-specific logic behind `packages/backend-blockbench`.
4. Keep clean-room execution in `packages/backend-engine` (incremental rollout).
5. Serialize mutating requests per project in gateway paths to preserve revision safety.
6. Treat `toolSchemaVersion` as coarse and `toolRegistry.hash` as authoritative for client cache refresh.
